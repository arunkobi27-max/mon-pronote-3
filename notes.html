<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PRONOTE | Mes Notes</title>
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
</head>
<body class="light-mode">

    <aside class="sidebar">
        <div class="logo"><i class="fa-solid fa-graduation-cap"></i> <span>PRONOTE</span></div>
        <nav>
            <ul>
                <li><a href="index.html" class="menu-link"><i class="fa-solid fa-house"></i> Accueil</a></li>
                <li><a href="emploi.html" class="menu-link"><i class="fa-solid fa-calendar-days"></i> Emploi du temps</a></li>
                <li class="active"><a href="notes.html" class="menu-link"><i class="fa-solid fa-star"></i> Notes</a></li>
                <li><a href="agenda.html" class="menu-link"><i class="fa-solid fa-book"></i> Agenda</a></li>
                <li><a href="reglages.html" class="menu-link"><i class="fa-solid fa-gear"></i> Réglages</a></li>
            </ul>
        </nav>
    </aside>

    <main class="content">
        <header>
            <div class="welcome-msg">
                <h1>Mes Notes</h1>
                <p>Calculateur de moyenne en temps réel</p>
            </div>
            <div class="overall-average-card">
                Moyenne Générale : <span id="general-average">--</span>/20
            </div>
        </header>

        <div class="grid-dashboard">
            <div class="card note-card">
                <h3>Mathématiques</h3>
                <div class="input-group">
                    <input type="number" class="note-input" placeholder="Note 1" oninput="calculateMoyenne()">
                    <input type="number" class="note-input" placeholder="Note 2" oninput="calculateMoyenne()">
                </div>
                <div class="moyenne-display">Moyenne : <span class="sub-moy">--</span></div>
            </div>

            <div class="card note-card">
                <h3>Français</h3>
                <div class="input-group">
                    <input type="number" class="note-input" placeholder="Note 1" oninput="calculateMoyenne()">
                    <input type="number" class="note-input" placeholder="Note 2" oninput="calculateMoyenne()">
                </div>
                <div class="moyenne-display">Moyenne : <span class="sub-moy">--</span></div>
            </div>

            <div class="card note-card">
                <h3>Anglais</h3>
                <div class="input-group">
                    <input type="number" class="note-input" placeholder="Note 1" oninput="calculateMoyenne()">
                    <input type="number" class="note-input" placeholder="Note 2" oninput="calculateMoyenne()">
                </div>
                <div class="moyenne-display">Moyenne : <span class="sub-moy">--</span></div>
            </div>
        </div>
    </main>

   <script>
    const matieres = [
        "Mathématiques", "Français", "Anglais LV1", "Histoire-Géo", 
        "Physique-Chimie", "SVT", "Technologie", "Espagnol LV2", 
        "EPS", "Arts Plastiques", "Éducation Musicale", "Vie Scolaire"
    ];

    const grid = document.getElementById('notes-grid');

    matieres.forEach(m => {
        const card = document.createElement('div');
        card.className = 'card note-card';
        card.innerHTML = `
            <h3>${m}</h3>
            <div class="labels-row">
                <small>Note</small> <small>Base</small> <small>Coeff</small>
            </div>
            <div class="notes-container" id="container-${m}">
                <div class="note-row">
                    <input type="number" class="val" placeholder="0" oninput="calc()">
                    <input type="number" class="base" value="20" oninput="calc()">
                    <input type="number" class="coeff" value="1" oninput="calc()">
                    <button class="delete-btn" onclick="removeNote(this)">×</button>
                </div>
            </div>
            <button class="add-note-btn" onclick="addNoteLine('${m}')">+ Ajouter une note</button>
            <div class="moyenne-display">Moyenne : <span class="sub-moy">--</span></div>
        `;
        grid.appendChild(card);
    });

    // Fonction pour ajouter une ligne
    function addNoteLine(id) {
        const container = document.getElementById(`container-${id}`);
        const div = document.createElement('div');
        div.className = 'note-row';
        div.innerHTML = `
            <input type="number" class="val" placeholder="0" oninput="calc()">
            <input type="number" class="base" value="20" oninput="calc()">
            <input type="number" class="coeff" value="1" oninput="calc()">
            <button class="delete-btn" onclick="removeNote(this)">×</button>
        `;
        container.appendChild(div);
        calc();
    }

    // NOUVELLE FONCTION : Supprimer une ligne
    function removeNote(btn) {
        const row = btn.parentElement;
        row.remove(); // Supprime la ligne du code
        calc(); // Recalcule la moyenne immédiatement
    }

    function calc() {
        const cards = document.querySelectorAll('.note-card');
        let sommeMoyennes = 0;
        let nbMatieres = 0;

        cards.forEach(card => {
            const rows = card.querySelectorAll('.note-row');
            let pointsPonderes = 0;
            let totalCoeffs = 0;

            rows.forEach(row => {
                const v = parseFloat(row.querySelector('.val').value);
                const b = parseFloat(row.querySelector('.base').value);
                const c = parseFloat(row.querySelector('.coeff').value);

                if (!isNaN(v) && !isNaN(b) && !isNaN(c) && b > 0 && c >= 0) {
                    let noteSur20 = (v / b) * 20;
                    pointsPonderes += (noteSur20 * c);
                    totalCoeffs += c;
                }
            });

            const display = card.querySelector('.sub-moy');
            if (totalCoeffs > 0) {
                let moy = pointsPonderes / totalCoeffs;
                display.innerText = moy.toFixed(2) + "/20";
                sommeMoyennes += moy;
                nbMatieres++;
            } else {
                display.innerText = "--";
            }
        });

        const genDisplay = document.getElementById('general-average');
        const avgBox = document.getElementById('avg-box');
        if (nbMatieres > 0) {
            let gen = sommeMoyennes / nbMatieres;
            genDisplay.innerText = gen.toFixed(2);
            avgBox.style.background = gen >= 10 ? "var(--primary)" : "#e74c3c";
        } else {
            genDisplay.innerText = "--";
            avgBox.style.background = "var(--card-bg)";
        }
    }
</script>
</body>
</html>
