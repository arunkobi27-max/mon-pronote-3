<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <title>PRONOTE | Relev√© de Notes</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <aside class="sidebar">
        <div class="logo">PRONOTE</div>
        <nav>
            <ul>
                <li><a href="index.html" class="menu-link">üè† Accueil</a></li>
                <li><a href="emploi.html" class="menu-link">üìÖ Emploi du temps</a></li>
                <li class="active"><a href="notes.html" class="menu-link">üìä Notes</a></li>
                <li><a href="agenda.html" class="menu-link">üìö Agenda</a></li>
                <li><a href="reglages.html" class="menu-link">‚öôÔ∏è R√©glages</a></li>
            </ul>
        </nav>
    </aside>

    <main class="content">
        <div class="header-bar">
            <h2>Relev√© de notes - Trimestre 1</h2>
            <div style="font-size: 1.2em;">Moyenne G√©n√©rale : <strong id="total-avg" style="color:var(--primary)">--</strong></div>
        </div>

        <table class="modern-table">
            <thead>
                <tr>
                    <th style="width: 200px;">Mati√®re</th>
                    <th>√âvaluations (Note / Bar√®me / Coeff)</th>
                    <th style="width: 100px; text-align: center;">Moyenne</th>
                </tr>
            </thead>
            <tbody id="table-body">
                </tbody>
        </table>
    </main>

    <script>
        const matieres = [
            "Math√©matiques", "Fran√ßais", "Anglais LV1", "Histoire-G√©o", 
            "Physique-Chimie", "SVT", "Technologie", "Espagnol LV2", 
            "EPS", "Arts Plastiques", "√âducation Musicale", "Vie Scolaire",
            "Enseignement Moral", "Latin", "Option Info"
        ];

        const tbody = document.getElementById('table-body');

        matieres.forEach(m => {
            const row = document.createElement('tr');
            row.innerHTML = `
                <td><strong>${m}</strong></td>
                <td>
                    <div id="container-${m.replace(/\s/g, '')}" class="notes-flex">
                        <div class="note-entry">
                            <input type="number" class="val" placeholder="Note" oninput="calc()">
                            <span>/</span>
                            <input type="number" class="base" value="20" oninput="calc()">
                            <small>Coeff:</small>
                            <input type="number" class="coeff" value="1" oninput="calc()">
                            <button class="btn-del" onclick="this.parentElement.remove();calc()">√ó</button>
                        </div>
                    </div>
                    <button class="btn-add" onclick="addNote('${m.replace(/\s/g, '')}')">+ Ajouter une note</button>
                </td>
                <td style="text-align: center;"><span class="sub-avg" style="font-weight:bold">--</span></td>
            `;
            tbody.appendChild(row);
        });

        function addNote(id) {
            const container = document.getElementById(`container-${id}`);
            const div = document.createElement('div');
            div.className = 'note-entry';
            div.innerHTML = `
                <input type="number" class="val" placeholder="Note" oninput="calc()">
                <span>/</span>
                <input type="number" class="base" value="20" oninput="calc()">
                <small>Coeff:</small>
                <input type="number" class="coeff" value="1" oninput="calc()">
                <button class="btn-del" onclick="this.parentElement.remove();calc()">√ó</button>
            `;
            container.appendChild(div);
        }

        function calc() {
            let totalGeneral = 0; let nbMatieres = 0;
            document.querySelectorAll('#table-body tr').forEach(tr => {
                const subAvgSpan = tr.querySelector('.sub-avg');
                let points = 0; let coeffs = 0;
                
                tr.querySelectorAll('.note-entry').forEach(entry => {
                    const v = parseFloat(entry.querySelector('.val').value);
                    const b = parseFloat(entry.querySelector('.base').value);
                    const c = parseFloat(entry.querySelector('.coeff').value);
                    if(!isNaN(v) && b > 0 && c > 0) {
                        points += (v/b*20) * c;
                        coeffs += c;
                    }
                });

                if(coeffs > 0) {
                    let m = points/coeffs;
                    subAvgSpan.innerText = m.toFixed(2);
                    totalGeneral += m; nbMatieres++;
                } else { subAvgSpan.innerText = "--"; }
            });
            document.getElementById('total-avg').innerText = nbMatieres > 0 ? (totalGeneral/nbMatieres).toFixed(2) + "/20" : "--";
        }
    </script>
</body>
</html>
