<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <title>PRONOTE | Notes</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>

    <aside class="sidebar">
        <div class="logo">PRONOTE</div>
        <nav>
            <ul>
                <li><a href="index.html" class="menu-link">Accueil</a></li>
                <li><a href="emploi.html" class="menu-link">Emploi du temps</a></li>
                <li class="active"><a href="notes.html" class="menu-link">Notes</a></li>
            </ul>
        </nav>
    </aside>

    <main class="content">
        <header>
            <h2>Relevé de notes</h2>
            <div>Moyenne Générale : <strong id="total-avg">--</strong></div>
        </header>

        <table class="notes-table">
            <thead>
                <tr>
                    <th>Matière</th>
                    <th>Notes / Barème / Coeff</th>
                    <th>Moyenne</th>
                </tr>
            </thead>
            <tbody id="table-body">
                </tbody>
        </table>
    </main>

    <script>
        const matieres = ["Mathématiques", "Français", "Anglais", "Histoire-Géo", "SVT", "Physique-Chimie", "Technologie", "EPS"];
        const tbody = document.getElementById('table-body');

        matieres.forEach(m => {
            const row = document.createElement('tr');
            row.innerHTML = `
                <td><strong>${m}</strong></td>
                <td>
                    <div id="container-${m}">
                        <div style="margin-bottom:5px">
                            <input type="number" class="val" oninput="calc()"> / 
                            <input type="number" class="base" value="20" oninput="calc()"> | 
                            Coeff: <input type="number" class="coeff" value="1" oninput="calc()">
                            <button class="btn-del" onclick="this.parentElement.remove();calc()">×</button>
                        </div>
                    </div>
                    <button class="btn-add" onclick="addNote('${m}')">+ Ajouter</button>
                </td>
                <td><span class="sub-avg">--</span></td>
            `;
            tbody.appendChild(row);
        });

        function addNote(id) {
            const container = document.getElementById(`container-${id}`);
            const div = document.createElement('div');
            div.style.marginBottom = "5px";
            div.innerHTML = `
                <input type="number" class="val" oninput="calc()"> / 
                <input type="number" class="base" value="20" oninput="calc()"> | 
                Coeff: <input type="number" class="coeff" value="1" oninput="calc()">
                <button class="btn-del" onclick="this.parentElement.remove();calc()">×</button>
            `;
            container.appendChild(div);
        }

        function calc() {
            let totalGeneral = 0; let nbMatieres = 0;
            document.querySelectorAll('tr').forEach(tr => {
                const subAvgSpan = tr.querySelector('.sub-avg');
                if(!subAvgSpan) return;

                let points = 0; let coeffs = 0;
                tr.querySelectorAll('.val').forEach((input, i) => {
                    const v = parseFloat(input.value);
                    const b = parseFloat(tr.querySelectorAll('.base')[i].value);
                    const c = parseFloat(tr.querySelectorAll('.coeff')[i].value);
                    if(!isNaN(v) && b > 0) {
                        points += (v/b*20) * c;
                        coeffs += c;
                    }
                });

                if(coeffs > 0) {
                    let m = points/coeffs;
                    subAvgSpan.innerText = m.toFixed(2);
                    totalGeneral += m; nbMatieres++;
                } else { subAvgSpan.innerText = "--"; }
            });
            document.getElementById('total-avg').innerText = nbMatieres > 0 ? (totalGeneral/nbMatieres).toFixed(2) : "--";
        }
    </script>
</body>
</html>
